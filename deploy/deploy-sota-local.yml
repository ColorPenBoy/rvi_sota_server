---
services:
  - name: mysql
    repo: advancedtelematic/mariadb
    ports:
      - 3306
    env:
      MYSQL_ROOT_PASSWORD: "{{ db_root_password }}"
      MYSQL_USER: "{{ db_user }}"
      MYSQL_PASSWORD: "{{ db_user_password }}"
      MYSQL_DATABASES: "{{ db_resolver_name }} {{ db_core_name }}"

  - name: rvi_server
    version: server
    repo: advancedtelematic/rvi:server
    ports:
      - 8801
      - 8802
      - 8803
      - 8804
      - 8805
      - 8806
      - 8807
    attach: true

  - name: rvi_client
    version: client
    repo: advancedtelematic/rvi:client
    ports:
      - 8901
      - 8907
      - 8908
    links:
      - rvi_server
    attach: true

  - name: resolver
    repo: sota-resolver
    pull: false
    ports:
      - 8081
    expose:
      - "8081"
    links:
      - mysql
    env:
      HOST: 0.0.0.0
      RESOLVER_DB_URL: "jdbc:mysql://mysql:3306/{{ db_resolver_name }}"

  - name: core
    repo: sota-core
    pull: false
    ports:
      - 8080
    expose:
      - "8080"
    links:
      - mysql
      - resolver
    env:
      HOST: 0.0.0.0
      CORE_DB_URL: "jdbc:mysql://mysql:3306/{{ db_core_name }}"
      RESOLVER_PORT: "8080"
      RESOLVER_HOST: "resolver"

  - name: webserver
    repo: sota-webserver
    links:
      - resolver
    pull: false
    ports:
      - 80:9000
    env:
      RESOLVER_PORT: "8080"
      RESOLVER_HOST: "resolver"

